---
title: "Final Group Work"
author: "Study Group 12 (Pierre Delfosse, Yixuan Li, Michael Mulianto, Raphael Toth, Jiarui Wang, Devang Mehta)"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: flatly
    highlight: zenburn
    number_sections: yes
    toc: yes
    toc_float: yes
    code_folding: show
---

```{r, setup, echo=FALSE}
knitr::opts_chunk$set(
  message = FALSE, 
  warning = FALSE, 
  tidy=FALSE,     # display code as typed
  size="small")   # slightly smaller font for code
options(digits = 3)

# default figure size
knitr::opts_chunk$set(
  fig.width=6.75, 
  fig.height=6.75,
  fig.align = "center"
)
```

```{r load-libraries, echo=FALSE}
library(tidyverse)
library(mosaic)
library(ggthemes)
library(readxl)
library(here)
library(skimr)
library(janitor)
library(broom)
library(skimr)
library(lubridate)
library(plyr)
```

## Introduction:

1.  [**Data Preparation:**]{.underline}

```{r}
# Import data and clean names
whr2015_2022 <- read.csv(here::here("data/world-happiness-report-2015-2022-cleaned.csv"),
                     stringsAsFactors = FALSE)%>%
  janitor::clean_names() 
  
# Remove the index column
whr2015_2022 <- select(whr2015_2022, -x) 

# Replace commas with dots and remove asterisks
whr2015_2022 <- data.frame(lapply(whr2015_2022, function(x) gsub(",", ".", x)))
whr2015_2022 <- data.frame(lapply(whr2015_2022, function(x) gsub("\\*", "", x)))

# Convert columns to numeric
columns_to_convert <- c("happiness_rank", "happiness_score", "economy_gdp_per_capita", "family_social_support", "health_life_expectancy", "freedom", "trust_government_corruption", "generosity", "year")
whr2015_2022[columns_to_convert] <- lapply(whr2015_2022[columns_to_convert], as.numeric)

# Mapping for inconsistent country names
country_name_mapping <- c(
  "Taiwan Province of China" = "Taiwan",
  "Hong Kong S.A.R. of China" = "Hong Kong",
  "Hong Kong S.A.R., China" = "Hong Kong",
  "Hong Kong S.A.R.. China" = "Hong Kong",
  "Czechia" = "Czech Republic",
  "North Macedonia" = "Macedonia", 
  "Trinidad & Tobago" = "Trinidad and Tobago", 
  "North Cyprus" = "Northern Cyprus")

# Apply the mapping to consolidate country names
whr2015_2022$country <- mapvalues(whr2015_2022$country, from = names(country_name_mapping), to = country_name_mapping)

# Mapping for inconsistent region names
region_name_mapping <- c(
  "Eastern Asia" = "East Asia",
  "Southeastern Asia" = "Southeast Asia",
  "Southern Asia" = "South Asia",
  "Middle East and Northern Africa" = "Middle East and North Africa")

# Apply the mapping to consolidate region names
whr2015_2022$region <- mapvalues(whr2015_2022$region, from = names(region_name_mapping), to = region_name_mapping)

# Define the correct region for each country based on the standardized assignments
correct_regions <- c(
  "Armenia" = "Central and Eastern Europe",
  "Australia" = "Australia and New Zealand",
  "Taiwan" = "East Asia",
  "Belize" = "Latin America and Caribbean",
  "Hong Kong" = "East Asia",
  "Somalia" = "Sub-Saharan Africa",
  "Namibia" = "Sub-Saharan Africa",
  "South Sudan" = "Sub-Saharan Africa",
  "Trinidad and Tobago" = "Latin America and Caribbean",
  "North Cyprus" = "Western Asia or Europe",
  "Macedonia" = "Central and Eastern Europe",
  "Gambia" = "Sub-Saharan Africa",
  "Luxembourg" = "Western Europe",
  "Czech Republic" = "Central and Eastern Europe",
  "Guatemala" = "Latin America and Caribbean",
  "Kuwait" = "Middle East and North Africa",
  "Belarus" = "Central and Eastern Europe",
  "Turkmenistan" = "Central and Eastern Europe",
  "Libya" = "Middle East and North Africa",
  "Azerbaijan" = "Central and Eastern Europe",
  "Liberia" = "Sub-Saharan Africa",
  "Congo" = "Sub-Saharan Africa",
  "Niger" = "Sub-Saharan Africa",
  "Comoros" = "Sub-Saharan Africa",
  "Palestinian Territories" = "Middle East and North Africa",
  "Eswatini. Kingdom of" = "Sub-Saharan Africa",
  "Madagascar" = "Sub-Saharan Africa",
  "Chad" = "Sub-Saharan Africa",
  "Yemen" = "Middle East and North Africa",
  "Mauritania" = "Sub-Saharan Africa",
  "Lesotho" = "Sub-Saharan Africa",
  "Botswana" = "Sub-Saharan Africa",
  "Rwanda" = "Sub-Saharan Africa",
  "Canada" = "North America",
  "Georgia" = "Central and Eastern Europe",
  "Kazakhstan" = "Central and Eastern Europe",
  "Kyrgyzstan" = "Central and Eastern Europe",
  "Moldova" = "Central and Eastern Europe",
  "New Zealand" = "Australia and New Zealand",
  "Russia" = "Central and Eastern Europe",
  "Tajikistan" = "Central and Eastern Europe",
  "Ukraine" = "Central and Eastern Europe",
  "United States" = "North America",
  "Uzbekistan" = "Central and Eastern Europe",
  "Northern Cyprus" = "Europe"
)

# Update the region for each country in the dataset
for (country in names(correct_regions)) {
  whr2015_2022[whr2015_2022$country == country, "region"] <- correct_regions[country]
}

# View the updated data
glimpse(whr2015_2022)
```

2.  [**Data exploration:**]{.underline}

```{r}
skim(whr2015_2022)
```

```{r}


```
